<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body {
            margin: 30px auto;
            padding: 0;
            background: #f7f9f8;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #ap {
            width: 900px;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            padding: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #fff;
            border-radius: 12px;
        }

        th {
            background: #fafafa;
            text-align: left;
            padding: 20px;
            font-weight: normal;
            border-bottom: 1px solid #eee;
        }

        tr:nth-child(even) {
            background-color: #fff;
        }

        th span {
            display: block;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: -10px;
            color: #2e4d43;
        }

        #content {
            margin-top: 30px;
            font-size: 20px;
            color: #444;
        }

        #img {
            width: 50px;
            height: 50px;
            border: 0px solid black;
            margin: 10px 10px;
            background-image: url("user.png");
            background-repeat: no-repeat;
            border-radius: 50%;
            clear: both;
        }

        #comment {
            margin: 5px 0 20px 0;
            float: left;
            font-size: 15px;
        }

        #a {
            clear: both;
            margin-top: 20px;
            display: flex;
            align-items: center;
        }

        #a input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            margin: 0 10px;
            font-size: 14px;
        }

        #a button {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            background: #7fb5a8;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            height: 75px;
        }

        #a button:hover {
            background: #5d9f91;
        }

        #tool {
            padding: 10px 10px;
            justify-content: flex-end;
        }

        #tool button {
            background: linear-gradient(90deg, #7fb5a8, #5d9f91);
            color: #fff;
            border: none;
            border-radius: 10px;
            font-size: 30px;
            font-weight: bold;
            padding: 15px 20px;
            cursor: pointer;
        }

        #tool button:hover {
            background: linear-gradient(90deg, #6aa194, #4b877b);
        }

        a:hover {
            text-decoration: none;
        }

        /* ===== 상단 고정 헤더 ===== */
        .header {
            position: relative;
            top: 20px;
            right: 30px;
            display: flex;
            align-items: center;
        }

        #name {
            position: absolute;
            font-size: 25px;
            color: #2e5d50;
            top: -20px;
            right: 100px;
        }

        #logout button {
            position: absolute;
            font-size: 20px;
            background: linear-gradient(90deg, #7fb5a8, #5d9f91);
            color: #fff;
            border: none;
            border-radius: 10px;
            padding: 8px 18px;
            cursor: pointer;
            top: -25px;
            right: -40px;
        }

        #logout button:hover {
            background: linear-gradient(90deg, #6aa194, #4b877b);
        }

        /* ===== 상단 로고 영역 ===== */
        #home {
            margin-top: 50px;
            text-align: center;
            font-size: 50px;
            font-weight: bold;
        }

        #home a {
            color: #2e4d43;
            text-decoration: none;
        }

        #home a:hover {
            text-decoration: none;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="header">
            <span id="name"></span>
            <span id="logout">
                <button v-if="login" @click="fnLogout">로그아웃</button>
                <button v-else @click="fnLogin">로그인</button>
            </span>
        </div>
        <div id="home" style="font-size: 50px; text-align: center; font-weight: bold;">
            <a href="Project_Homepage.html">
                <img src="mark.png" width="50" height="50" style="margin: -5px -5px;">
                좋은 요양원
            </a>
        </div>
        <div id="ap">
            <div id="tool">
                <template v-if="sessionId === info1.GUARDIAN_ID || sessionId === info1.CAREGIVER_ID || status === 'A'">
                    <button @click="fnEdit" style="width: 110px; height: 80px;">수정</button>
                    <button @click="fnRemove(info1)" style="margin: 10px 10px; width: 110px; height: 80px;">삭제</button>
                </template>
            </div>
            <table>
                <tr>
                    <th>
                        <span style="font-size: 60px;">{{info1.title}}</span>
                        <div id="img" style="background-size: cover;"></div>
                        <div>{{info1.name}}</div>
                        <div>{{info1.ctime}} 조회 {{info1.cnt}}</div>
                        <hr>
                        <div id="content" style="height: 300px; text-align: left;">
                            <div v-html="info1.contents"></div>
                        </div>
                    </th>
                </tr>
                <tr>
                    <th>
                        <div v-for="item in info2">
                            <div id="img" style="background-size: cover; float: left"></div>
                            <div id="comment">
                                <span>{{item.NAME}}</span>
                                <br>
                                <span>{{item.COMMENT1}}</span>
                                <br>
                                <span style="font-size: 10px;">{{item.CTIME}}</span>
                                <br>
                            </div>
                        </div>
                        <div id="a">
                            <span>{{info2.NAME}}</span>
                            <input type="text" v-model="commentText" placeholder="댓글을 남겨보세요."
                                style="height: 50px; width: 350px;">
                            <button @click="fnAdd">등록</button>
                        </div>
                    </th>
                </tr>
            </table>
            <div>
                <a href="Project_Board_List.html"><button>목록</button></a>
            </div>
        </div>

    </div>
</body>

</html>

<script>
    const app = Vue.createApp({
        data() {
            return {
                // 변수 - (key : value)
                boardNo: "",
                info1: {},
                info2: {},
                commentText: "",
                userId: "",
                login: false,
                name: "",
                status: "", 
                sessionId: ""
            };
        },
        methods: {
            // 함수(메소드) - (key : function())
            fnInfo1: function () {
                let self = this;
                let param = {
                    boardNo: self.boardNo
                };
                $.ajax({
                    url: "http://localhost:3009/user/info1",
                    dataType: "json",
                    type: "GET",
                    data: param,
                    success: function (data) {
                        self.info1 = data.info;
                        console.log(data);
                    }
                });
            },

            fnInfo2: function () {
                let self = this;
                let param = {
                    boardNo: self.boardNo
                };
                $.ajax({
                    url: "http://localhost:3009/user/info2",
                    dataType: "json",
                    type: "GET",
                    data: param,
                    success: function (data) {
                        self.info2 = data.info;
                        console.log(data);
                    }
                });
            },

            fnAdd: function () {
                let self = this;
                let param = {
                    boardNo: self.boardNo,
                    comment: self.commentText,
                    userId: "user01"
                };
                $.ajax({
                    url: "http://localhost:3009/comment/insert",
                    dataType: "json",
                    type: "GET",
                    data: param,
                    success: function (data) {
                        console.log(data);
                        if (data.result == "success") {
                            location.href = "Project_Board_View.html";
                        }

                    }
                });
            },

            fnLogout: function () {
                let self = this;
                sessionStorage.removeItem("sessionId");
                sessionStorage.removeItem("sessionStatus");
                alert("로그아웃 되었습니다.");
                self.login = false;
                location.href = "Project_Homepage.html";
            },

            fnLogin: function () {
                location.href = "Project_Login.html";
            },
            fnEdit: function () {
                let self = this;
                location.href = `Project_Edit.html?boardNo=${this.boardNo}`;
            },
            fnRemove: function () {
                let self = this;
                if (!confirm("정말 삭제하시겠습니까?")) {
                    return;
                }
                $.ajax({
                    url: "http://localhost:3009/pro/delete",
                    dataType: "json",
                    type: "GET",
                    data: { boardNo: self.boardNo },
                    success: function (data) {
                        alert("삭제되었습니다.");
                        location.href = "Project_Board_List.html";
                        self.selectItem = "";
                    }
                });
            }

        }, // methods
        mounted() {
            // 처음 시작할 때 실행되는 부분
            let self = this;
            const queryParams = new URLSearchParams(window.location.search);
            self.boardNo = queryParams.get('boardNo') || '';

            self.sessionId = sessionStorage.getItem("sessionId");
            self.status = sessionStorage.getItem("sessionStatus");
            self.name = sessionStorage.getItem("sessionName");

            if (self.sessionId && self.status) {
                self.login = true;
            } else {
                self.login = false;
            }

            if (self.name) {
                let title = document.querySelector("#name");
                if (title) {
                    title.innerText = self.name + "님";
                }
            }
            if (self.boardNo) {
                self.fnInfo1();
                self.fnInfo2();
            } else {

            }


        }
    });

    app.mount('#app');
</script>